
namespace = mafoe_recalculate_development

# Calculates the progress of development growth of all provinces of one country.
# Is called every 2 years by on_action pulse.

country_event = {
	id = mafoe_recalculate_development.1
	title = "wont_translate.title"
	desc = "wont_translate.desc"
	picture = CITY_DEVELOPMENT_eventPicture

	hidden = yes
	is_triggered_only = yes

    immediate = {
        hidden_effect = {

            every_owned_province = {

        # initialise these variables with flat growth of 5 points for all
                set_variable = { which = temp_tax value = 5 }
                set_variable = { which = temp_prod value = 5 }
                set_variable = { which = temp_mp value = 5 }

                set_variable = { which = log1 which = temp_tax }

         #############
         # Now multiply flat growth with all the yummy multipliers
         # factors are:
         #   - local development cost (from terrain and such)
         #   - development cost (this is global)
         #   - development efficiency (has 3 tiers from adm tech, each is 0.1 or 10%)
         #   - growth boost active (decision, one per monarch power)
         #############

                # malus, used to balance the numbers
                multiply_variable = { which = temp_tax value = 0.5 }
                multiply_variable = { which = temp_prod value = 0.5 }
                multiply_variable = { which = temp_mp value = 0.5 }

                set_variable = { which = log2 which = temp_tax }

                # faster with higher development efficiency
                # has 3 tiers from all 3 tech, each is 0.1 or 10%, at tech 17, 23, 27
                # gotta ask for techs because there is no way to programmatically check development_efficiency
                # Thanks, Paradox! Might as well make it fancier and check dip for dip, and mil for mp instead of just adm tech
                if = {
                    limit = {
                        owner = {
                            adm_tech = 17
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            adm_tech = 23
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            adm_tech = 27
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            dip_tech = 17
                        }
                    }
                    multiply_variable = { which = temp_prod value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            dip_tech = 23
                        }
                    }
                    multiply_variable = { which = temp_prod value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            dip_tech = 27
                        }
                    }
                    multiply_variable = { which = temp_prod value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            mil_tech = 17
                        }
                    }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            mil_tech = 23
                        }
                    }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            mil_tech = 27
                        }
                    }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }

                set_variable = { which = log3 which = temp_tax }

        		# so apparently we can't check local development cost either, so how about a long list of checks? ugh...
                # todo local dev cost and dev cost - there are so many sources, i cba with this crap

                set_variable = { which = log4 which = temp_tax }

                # and global development cost is a no go either, so yea, more lists...
                if = {
                    limit = {
                        owner = {
                            government = imperial_city
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                    multiply_variable = { which = temp_prod value = 1.1 }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            has_church_aspect = organised_through_bishops_aspect
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.05 }
                    multiply_variable = { which = temp_prod value = 1.05 }
                    multiply_variable = { which = temp_mp value = 1.05 }
                }
                if = {
                    limit = {
                        owner = {
                            has_idea = custom_idea_development_cost
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                    multiply_variable = { which = temp_prod value = 1.1 }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }
                if = {
                    limit = {
                        owner = {
                            has_disaster  = estate_nomadic_tribes_disaster
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.5 }
                    multiply_variable = { which = temp_prod value = 1.5 }
                    multiply_variable = { which = temp_mp value = 1.5 }
                }
                # not exactly, since the value should scale with loyalty, but wtf...
                if = {
                    limit = {
                        owner = {
                             estate_loyalty = {
                                 estate = estate_burghers
                                 loyalty = 60
                             }
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                    multiply_variable = { which = temp_prod value = 1.1 }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }
                if = {
                    limit = {
                        NOT = {
                            owner = {
                                estate_loyalty = {
                                         estate = estate_burghers
                                         loyalty = 40
                                }
                            }
                        }
                    }
                    multiply_variable = { which = temp_tax value = 0.9 }
                    multiply_variable = { which = temp_prod value = 0.9 }
                    multiply_variable = { which = temp_mp value = 0.9 }
                }

                set_variable = { which = log5 which = temp_tax }

        		# slower for tribal societies (+50%)
                if = {
                    limit = {
                        owner = {
                            OR = {
                                is_tribal = yes
                                is_nomad = yes
                            }
                        }
                    }
                    multiply_variable = { which = temp_tax value = 0.5 }
                    multiply_variable = { which = temp_prod value = 0.5 }
                    multiply_variable = { which = temp_mp value = 0.5 }
                }

                # faster in important trade provinces
                if = {
                    limit = {
                        OR = {
                            has_province_modifier = important_natural_harbor
                            has_province_modifier = inland_center_of_trade_modifier
                            has_province_modifier = center_of_trade_modifier
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.05 }
                    multiply_variable = { which = temp_prod value = 1.05 }
                    multiply_variable = { which = temp_mp value = 1.05 }
                }

        		# slower for colonies (+50%)
                if = {
                    limit = {
                        is_colony = yes
                    }
                    multiply_variable = { which = temp_tax value = 0.5 }
                    multiply_variable = { which = temp_prod value = 0.5 }
                    multiply_variable = { which = temp_mp value = 0.5 }
                }
        		# slower for islands (+20%)
                if = {
                    limit = {
                        island = yes
                    }
                    multiply_variable = { which = temp_tax value = 0.8 }
                    multiply_variable = { which = temp_prod value = 0.8 }
                    multiply_variable = { which = temp_mp value = 0.8 }
                }

        		# if tradegood is wheat, fish, salt, then tax and manpower grow faster
        		# equals -10%/-20% development cost bonus for tax/mp
        		# finally something useful from these!
                if = {
                    limit = {
                        OR = {
                            trade_goods = grain
                            trade_goods = fish
                            trade_goods = salt
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                    multiply_variable = { which = temp_mp value = 1.2 }
                }
        		# if tradegood is cloth or cotton, apparently everything grows faster
                if = {
                    limit = {
                        OR = {
                            trade_goods = cloth
                            trade_goods = cotton
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.1 }
                    multiply_variable = { which = temp_prod value = 1.1 }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }

                set_variable = { which = log6 which = temp_tax }

        		# now for the terrain
                # I hate you, paradox. couldnt you just make local_development_cost accessible? ffs...

                trigger_switch = {
                    on_trigger = has_terrain
                        farmlands = {
                            multiply_variable = { which = temp_tax value = 1.05 }
                            multiply_variable = { which = temp_prod value = 1.05 }
                            multiply_variable = { which = temp_mp value = 1.05 }
                        }
                        drylands = {
                            multiply_variable = { which = temp_tax value = 0.95 }
                            multiply_variable = { which = temp_prod value = 0.95 }
                            multiply_variable = { which = temp_mp value = 0.95 }
                        }
                        woods = {
                            multiply_variable = { which = temp_tax value = 0.85 }
                            multiply_variable = { which = temp_prod value = 0.85 }
                            multiply_variable = { which = temp_mp value = 0.85 }
                        }
                        savannah = {
                            multiply_variable = { which = temp_tax value = 0.85 }
                            multiply_variable = { which = temp_prod value = 0.85 }
                            multiply_variable = { which = temp_mp value = 0.85 }
                        }
                        forest = {
                            multiply_variable = { which = temp_tax value = 0.8 }
                            multiply_variable = { which = temp_prod value = 0.8 }
                            multiply_variable = { which = temp_mp value = 0.8 }
                        }
                        steppe = {
                            multiply_variable = { which = temp_tax value = 0.8 }
                            multiply_variable = { which = temp_prod value = 0.8 }
                            multiply_variable = { which = temp_mp value = 0.8 }
                        }
                        highlands = {
                            multiply_variable = { which = temp_tax value = 0.8 }
                            multiply_variable = { which = temp_prod value = 0.8 }
                            multiply_variable = { which = temp_mp value = 0.8 }
                        }
                        coastal_desert = {
                            multiply_variable = { which = temp_tax value = 0.75 }
                            multiply_variable = { which = temp_prod value = 0.75 }
                            multiply_variable = { which = temp_mp value = 0.75 }
                        }
                        coastline = {
                            multiply_variable = { which = temp_tax value = 0.75 }
                            multiply_variable = { which = temp_prod value = 0.75 }
                            multiply_variable = { which = temp_mp value = 0.75 }
                        }
                        hills = {
                            multiply_variable = { which = temp_tax value = 0.75 }
                            multiply_variable = { which = temp_prod value = 0.75 }
                            multiply_variable = { which = temp_mp value = 0.75 }
                        }
                        marsh = {
                            multiply_variable = { which = temp_tax value = 0.75 }
                            multiply_variable = { which = temp_prod value = 0.75 }
                            multiply_variable = { which = temp_mp value = 0.75 }
                        }
                        desert = {
                            multiply_variable = { which = temp_tax value = 0.65 }
                            multiply_variable = { which = temp_prod value = 0.65 }
                            multiply_variable = { which = temp_mp value = 0.65 }
                        }
                        jungle = {
                            multiply_variable = { which = temp_tax value = 0.65 }
                            multiply_variable = { which = temp_prod value = 0.65 }
                            multiply_variable = { which = temp_mp value = 0.65 }
                        }
                        mountain = {
                            multiply_variable = { which = temp_tax value = 0.5 }
                            multiply_variable = { which = temp_prod value = 0.5 }
                            multiply_variable = { which = temp_mp value = 0.5 }
                        }
                        glacier = {
                            multiply_variable = { which = temp_tax value = 0.5 }
                            multiply_variable = { which = temp_prod value = 0.5 }
                            multiply_variable = { which = temp_mp value = 0.5 }
                        }
                }

                trigger_switch = {
                    on_trigger = has_climate
                        arid = {
                            multiply_variable = { which = temp_tax value = 0.85 }
                            multiply_variable = { which = temp_prod value = 0.85 }
                            multiply_variable = { which = temp_mp value = 0.85 }
                        }
                        tropical = {
                            multiply_variable = { which = temp_tax value = 0.85 }
                            multiply_variable = { which = temp_prod value = 0.85 }
                            multiply_variable = { which = temp_mp value = 0.85 }
                        }
                        arctic = {
                            multiply_variable = { which = temp_tax value = 0.5 }
                            multiply_variable = { which = temp_prod value = 0.5 }
                            multiply_variable = { which = temp_mp value = 0.5 }
                        }
                }

                set_variable = { which = temp which = 1 }

                trigger_switch = {
                    on_trigger = has_province_modifier
                        forest_clearance = {
                            set_variable = { which = temp which = 1.15 }
                        }
                        farms = {
                            set_variable = { which = temp which = 1.05 }
                        }
                        land_reclamation = {
                            set_variable = { which = temp which = 1.25 }
                        }
                        coastline_improved = {
                            set_variable = { which = temp which = 1.25 }
                        }
                        hills_improved = {
                            set_variable = { which = temp which = 1.25 }
                        }
                        slash_and_burn = {
                            set_variable = { which = temp which = 1.2 }
                        }
                        irrigation = {
                            set_variable = { which = temp which = 1.1 }
                        }
                        terrace = {
                            set_variable = { which = temp which = 1.1 }
                        }
                }
                multiply_variable = { which = temp_tax which = temp }
                multiply_variable = { which = temp_prod which = temp }
                multiply_variable = { which = temp_mp which = temp }

                set_variable = { which = log7 which = temp_tax }


        		# faster when taxation/production/manpower boosts are active
                if = {
                    limit = {
            			owner = {
                			has_country_modifier = tax_growth_boosted
                        }
                    }
                    multiply_variable = { which = temp_tax value = 1.5 }
                }
                if = {
                    limit = {
            			owner = {
                			has_country_modifier = production_growth_boosted
                        }
                    }
                    multiply_variable = { which = temp_prod value = 1.5 }
                }
                if = {
                    limit = {
            			owner = {
                			has_country_modifier = manpower_growth_boosted
                        }
                    }
                    multiply_variable = { which = temp_mp value = 1.5 }
                }

                # now for the buildings... uch
                # can't do this by slapping local_development_cost on each building because each building is
                # supposed to only improve that development it belongs to, aka production buildings should only
                # boost production growth, not tax or manpower growth (special case: university)

                # tax buildings first...
                if = {
                    limit = {
            			has_building = temple
                    }
                    multiply_variable = { which = temp_tax value = 1.2 }
                }
                if = {
                    limit = {
            			has_building = cathedral
                    }
                    multiply_variable = { which = temp_tax value = 1.4 }
                }
                if = {
                    limit = {
            			has_building = courthouse
                    }
                    multiply_variable = { which = temp_tax value = 1.2 }
                }
                if = {
                    limit = {
            			has_building = town_hall
                    }
                    multiply_variable = { which = temp_tax value = 1.4 }
                }

                # ...production buildings second...
                if = {
                    limit = {
            			has_building = workshop
                    }
                    multiply_variable = { which = temp_prod value = 1.1 }
                }
                if = {
                    limit = {
            			has_building = counting_house
                    }
                    multiply_variable = { which = temp_prod value = 1.2 }
                }
                if = {
                    limit = {
            			has_building = marketplace
                    }
                    multiply_variable = { which = temp_prod value = 1.1 }
                }
                if = {
                    limit = {
            			has_building = trade_depot
                    }
                    multiply_variable = { which = temp_prod value = 1.2 }
                }
                if = {
                    limit = {
            			has_building = stock_exchange
                    }
                    multiply_variable = { which = temp_prod value = 1.3 }
                }

                # ...manufactories third...
                if = {
                    limit = {
            			has_building = wharf
                    }
                    multiply_variable = { which = temp_prod value = 1.3 }
                }
                if = {
                    limit = {
            			has_building = weapons
                    }
                    multiply_variable = { which = temp_prod value = 1.3 }
                }
                if = {
                    limit = {
            			has_building = textile
                    }
                    multiply_variable = { which = temp_prod value = 1.3 }
                }
                if = {
                    limit = {
            			has_building = plantations
                    }
                    multiply_variable = { which = temp_prod value = 1.3 }
                }
                if = {
                    limit = {
            			has_building = tradecompany
                    }
                    multiply_variable = { which = temp_prod value = 1.3 }
                }

                # ...military buildings fourth... (kill me nao!)
                if = {
                    limit = {
            			has_building = barracks
                    }
                    multiply_variable = { which = temp_mp value = 1.08 }
                }
                if = {
                    limit = {
            			has_building = training_fields
                    }
                    multiply_variable = { which = temp_mp value = 1.08 }
                }
                if = {
                    limit = {
            			has_building = regimental_camp
                    }
                    multiply_variable = { which = temp_mp value = 1.16 }
                }
                if = {
                    limit = {
            			has_building = conscription_center
                    }
                    multiply_variable = { which = temp_mp value = 1.16 }
                }
                if = {
                    limit = {
            			has_building = shipyard
                    }
                    multiply_variable = { which = temp_mp value = 1.08 }
                }
                if = {
                    limit = {
            			has_building = dock
                    }
                    multiply_variable = { which = temp_mp value = 1.08 }
                }
                if = {
                    limit = {
            			has_building = grand_shipyard
                    }
                    multiply_variable = { which = temp_mp value = 1.16 }
                }
                if = {
                    limit = {
            			has_building = drydock
                    }
                    multiply_variable = { which = temp_mp value = 1.16 }
                }

                # ...and forts last.
                if = {
                    limit = {
            			has_building = fort_15th
                    }
                    multiply_variable = { which = temp_mp value = 1.05 }
                }
                if = {
                    limit = {
            			has_building = fort_16th
                    }
                    multiply_variable = { which = temp_mp value = 1.1 }
                }
                if = {
                    limit = {
            			has_building = fort_17th
                    }
                    multiply_variable = { which = temp_mp value = 1.15 }
                }
                if = {
                    limit = {
            			has_building = fort_18th
                    }
                    multiply_variable = { which = temp_mp value = 1.2 }
                }

                set_variable = { which = log8 which = temp_tax }

                # university gets -50% bonus
                if = {
                    limit = {
                        has_building = university
                    }
                    multiply_variable = { which = temp_tax value = 1.5 }
                    multiply_variable = { which = temp_prod value = 1.5 }
                    multiply_variable = { which = temp_mp value = 1.5 }
                }


    #TODO looted, blockaded

            # slower with unrest
            # unrest is a special case. it can lead to negative growth
            # formula: if unrest is >= 0.5, then add (-1.5 * unrest - 1.5) to the progress
            # since we multiply flat growth and bonuses before we subtract a flat unrest penalty,  it is possible
            # to "power through" unrest later on in the game and have growing development despite unrest
                if = {
                    limit = {
            			unrest = 0.5
                    }
                    set_variable = { which = temp value = -1.5 }
                    multiply_variable = { which = temp which = unrest }
                    subtract_variable = { which = temp value = 1.5 }
                    change_variable = { which = temp_tax which = temp }
                    change_variable = { which = temp_prod which = temp }
                    change_variable = { which = temp_mp which = temp }
                }

                set_variable = { which = log9 which = temp_tax }

        ###### finally done! ######

        # add the temp values that we calculated in this event to the persistent progress
                change_variable = { which = tax_progress which = temp_tax }
                change_variable = { which = production_progress which = temp_prod }
                change_variable = { which = manpower_progress which = temp_mp }

        # If progress is >= 100, then increase base dev and reduce progress by 100
        # no need to check for >= 200 with current balancing
                if = {
                    limit = {
                        check_variable = { which = tax_progress value = 100 }
                    }
                    add_base_tax = 1
                    subtract_variable = { which = tax_progress value = 100 }
                }
                if = {
                    limit = {
                        check_variable = { which = production_progress value = 100 }
                    }
                    add_base_production = 1
                    subtract_variable = { which = production_progress value = 100 }
                }
                if = {
                    limit = {
                        check_variable = { which = manpower_progress value = 100 }
                    }
                    add_base_manpower = 1
                    subtract_variable = { which = manpower_progress value = 100 }
                }

        # gotta check negative growth, too

                if = {
                    limit = {
                        NOT = { check_variable = { which = tax_progress value = -100 }}
                    }
                    add_base_tax = -1
                    change_variable = { which = tax_progress value = 100 }
                }

                if = {
                    limit = {
                        NOT = { check_variable = { which = production_progress value = -100 }}
                    }
                    add_base_production = -1
                    change_variable = { which = production_progress value = 100 }
                }

                if = {
                    limit = {
                        NOT = { check_variable = { which = manpower_progress value = -100 }}
                    }
                    add_base_manpower = -1
                    change_variable = { which = manpower_progress value = 100 }
                }

        # set all unneeded variables to 0. Not sure this is helpful. No way to remove variables?
                    set_variable = { which = temp_tax value = 0 }
                    set_variable = { which = temp_prod value = 0 }
                    set_variable = { which = temp_mp value = 0 }
                    set_variable = { which = temp value = 0 }

        # NOW we're done... phew
            }
        }
    }

	option = {
		name = "wont_translate"
	}
}